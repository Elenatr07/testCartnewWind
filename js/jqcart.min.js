/*
 jQuery jqCart Plugin v1.1.2.1 (discount)
 requires jQuery v1.9 or later

 http://incode.pro/

 Date: Date: 2016-05-18 19:15
*/
(function(d){var b,k,g="",p=0,q=!1,l=d('<div class="jqcart-cart-label"><span class="jqcart-title">\u041e\u0444\u043e\u0440\u043c\u0438\u0442\u044c \u0437\u0430\u043a\u0430\u0437</span><span class="jqcart-total-cnt">0</span></div>'),c={buttons:".add_item",cartLabel:"body",visibleLabel:!1,openByAdding:!1,handler:"/",promoHandler:"/",discount:0,currency:"$"},e={init:function(a){c=d.extend(c,a);b=e.getStorage();if(null!==b&&Object.keys(b).length){for(var f in b)b.hasOwnProperty(f)&&(p+=b[f].count);q=
!0}l.prependTo(c.cartLabel)[q||c.visibleLabel?"show":"hide"]().on("click",e.openCart).find(".jqcart-total-cnt").text(p);c.discount=0<c.discount?c.discount:sessionStorage.getItem("discount")||0;d(document).on("click",c.buttons,e.addToCart).on("click",".jqcart-layout",function(a){a.target===this&&e.hideCart()}).on("click",".jqcart-incr",e.changeAmount).on("input keyup",".jqcart-amount",e.changeAmount).on("click",".jqcart-del-item",e.delFromCart).on("submit",".jqcart-orderform",e.sendOrder).on("reset",
".jqcart-orderform",e.hideCart).on("click",".jqcart-print-order",e.printOrder).on("change",'.jqcart-orderform input[name="promo_code"]',e.checkPromo);return!1},addToCart:function(a){a.preventDefault();k=d(this).data();if("undefined"===typeof k.id)return console.log("\u041e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442 ID \u0442\u043e\u0432\u0430\u0440\u0430"),!1;b=e.getStorage()||{};b.hasOwnProperty(k.id)?b[k.id].count++:(k.count=1,b[k.id]=k);e.setStorage(b);e.changeTotalCnt(1);l.show();
c.openByAdding&&e.openCart();return!1},delFromCart:function(){var a=d(this).closest(".jqcart-tr"),f=a.data("id");b=e.getStorage();e.changeTotalCnt(-b[f].count);delete b[f];e.setStorage(b);a.remove();e.recalcSum();return!1},changeAmount:function(){var a=d(this),f=a.hasClass("jqcart-amount"),h=+(f?a.val():a.data("incr")),c=a.closest(".jqcart-tr").data("id");b=e.getStorage();b[c].count=f?isNaN(h)||1>h?1:h:b[c].count+h;1>b[c].count&&(b[c].count=1);f?a.val(b[c].count):a.siblings("input").val(b[c].count);
e.setStorage(b);e.recalcSum();return!1},recalcSum:function(){var a=0,f,b=0,m=0;d(".jqcart-tr").each(function(){f=+d(".jqcart-amount",this).val();b=Math.ceil(f*d(".jqcart-price",this).text()*100)/100;d(".jqcart-sum",this).html(b+" "+c.currency);a=Math.ceil(100*(a+b))/100;m+=f});var g=e.calcDiscount(a),k=d(".jqcart-discount")[0<g?"show":"hide"]();k.find("span").text(c.discount);k.find("strong").text(g);d(".jqcart-subtotal strong").text(a-g);d(".jqcart-total-cnt").text(m);0>=m&&(e.hideCart(),c.visibleLabel||
l.hide());return!1},changeTotalCnt:function(a){var f=d(".jqcart-total-cnt");f.text(+f.text()+a);return!1},openCart:function(){var a=0;b=e.getStorage();g='<p class="jqcart-cart-title">\u041a\u043e\u0440\u0437\u0438\u043d\u0430 <span class="jqcart-print-order"></span></p><div class="jqcart-table-wrapper"><div class="jqcart-manage-order"><div class="jqcart-thead"><div>ID</div><div></div><div>\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435</div><div>\u0426\u0435\u043d\u0430</div><div>\u041a\u043e\u043b-\u0432\u043e</div><div>\u0421\u0443\u043c\u043c\u0430</div><div></div></div>';
for(h in b)if(b.hasOwnProperty(h)){var f=Math.ceil(b[h].count*b[h].price*100)/100;a=Math.ceil(100*(a+f))/100;g+='<div class="jqcart-tr" data-id="'+b[h].id+'">';g+='<div class="jqcart-small-td">'+b[h].id+"</div>";g+='<div class="jqcart-small-td jqcart-item-img"><img src="'+b[h].img+'" alt=""></div>';g+="<div>"+b[h].title+"</div>";g+='<div class="jqcart-price">'+b[h].price+"</div>";g+='<div><span class="jqcart-incr" data-incr="-1">&#8211;</span><input type="text" class="jqcart-amount" value="'+b[h].count+
'"><span class="jqcart-incr" data-incr="1">+</span></div>';g+='<div class="jqcart-sum">'+f+" "+c.currency+"</div>";g+='<div class="jqcart-small-td"><span class="jqcart-del-item"></span></div>';g+="</div>"}g+="</div></div>";f=e.calcDiscount(a);var h=sessionStorage.getItem("promocode");g+='<div class="jqcart-discount" style="display:'+(0<f?"block":"none")+';">\u0421\u043a\u0438\u0434\u043a\u0430 <span>'+c.discount+"</span>%: <strong>"+f+"</strong> "+c.currency+"</div>";g+='<div class="jqcart-subtotal">\u0418\u0442\u043e\u0433\u043e: <strong>'+
(a-f)+"</strong> "+c.currency+"</div>";a=a?g+'<p class="jqcart-cart-title">\u041a\u043e\u043d\u0442\u0430\u043a\u0442\u043d\u0430\u044f \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f:</p><form class="jqcart-orderform"><p><label>\u0424\u0418\u041e:</label><input type="text" name="user_name"></p><p><label>\u0422\u0435\u043b\u0435\u0444\u043e\u043d:</label><input type="text" name="user_phone"></p><p><label>Email:</label><input type="text" name="user_mail"></p><p><label>\u0410\u0434\u0440\u0435\u0441:</label><input type="text" name="user_address"></p><p><label>\u041f\u0440\u043e\u043c\u043e-\u043a\u043e\u0434:</label><input type="text" name="promo_code"></p><p><label>\u041a\u043e\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439:</label><textarea name="user_comment"></textarea></p><p><input type="submit" value="\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0437\u0430\u043a\u0430\u0437"><input type="reset" value="\u0412\u0435\u0440\u043d\u0443\u0442\u044c\u0441\u044f \u043a \u043f\u043e\u043a\u0443\u043f\u043a\u0430\u043c"></p></form>':
'<h2 class="jqcart-empty-cart">\u041a\u043e\u0440\u0437\u0438\u043d\u0430 \u043f\u0443\u0441\u0442\u0430</h2>';d('<div class="jqcart-layout"><div class="jqcart-checkout">123</div></div>').appendTo("body").find(".jqcart-checkout").html(a).find('[name="promo_code"]').val(h)},hideCart:function(){d(".jqcart-layout").fadeOut("fast",function(){d(this).remove()});return!1},sendOrder:function(a){a.preventDefault();a=d(this);if(""===d.trim(d("[name=user_name]",a).val())||""===d.trim(d("[name=user_phone]",
a).val()))return d('<p class="jqcart-error">\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0443\u043a\u0430\u0436\u0438\u0442\u0435 \u0441\u0432\u043e\u0435 \u0438\u043c\u044f \u0438 \u043a\u043e\u043d\u0442\u0430\u043a\u0442\u043d\u044b\u0439 \u0442\u0435\u043b\u0435\u0444\u043e\u043d!</p>').insertBefore(a).delay(3E3).fadeOut(),!1;d.ajax({url:c.handler,type:"POST",dataType:"json",data:{orderlist:d.param(e.getStorage()),userdata:a.serialize()},error:function(a,b,d){console.log("Error: "+
b+" | "+d)},success:function(a){d(".jqcart-checkout").html("<p>"+a.message+"</p>");a.errors||(c.discount=0,sessionStorage.setItem("promocode",""),sessionStorage.setItem("discount",0),setTimeout(n.clearCart,2E3))}})},checkPromo:function(){var a=d.trim(d(this).val());if(""===a)return!1;d.ajax({url:c.promoHandler,type:"POST",dataType:"json",data:{promo_code:a},error:function(a,b,d){console.log("Error: "+b+" | "+d)},success:function(b){console.log(b);c.discount=b||0;sessionStorage.setItem("promocode",
0<c.discount?a:"");sessionStorage.setItem("discount",c.discount);e.recalcSum()}})},calcDiscount:function(a){var b=isNaN(+c.discount)?0:+c.discount;return a*b/100},printOrder:function(){var a=d(this).closest(".jqcart-checkout").prop("outerHTML");if(!a)return!1;var b=window.open("","\u041f\u0435\u0447\u0430\u0442\u044c \u0437\u0430\u043a\u0430\u0437\u0430","width="+screen.width+",height="+screen.height),e=d(b.opener.document).find('link[href$="jqcart.css"]').attr("href"),c=new Date;c=("0"+c.getDate()).slice(-2)+
"-"+("0"+(c.getMonth()+1)).slice(-2)+"-"+c.getFullYear()+" "+("0"+c.getHours()).slice(-2)+":"+("0"+c.getMinutes()).slice(-2)+":"+("0"+c.getSeconds()).slice(-2);b.document.write("<html><head><title>\u0417\u0430\u043a\u0430\u0437 "+c+"</title>");b.document.write('<link rel="stylesheet" href="'+e+'" type="text/css" />');b.document.write("</head><body >");b.document.write(a);b.document.write("</body></html>");setTimeout(function(){b.document.close();b.focus();b.print();b.close()},100);return!0},setStorage:function(a){localStorage.setItem("jqcart",
JSON.stringify(a));return!1},getStorage:function(){return JSON.parse(localStorage.getItem("jqcart"))}},n={clearCart:function(){localStorage.removeItem("jqcart");l[c.visibleLabel?"show":"hide"]().find(".jqcart-total-cnt").text(0);e.hideCart()},openCart:e.openCart,printOrder:e.printOrder,test:function(){e.getStorage()}};d.jqCart=function(a){if(n[a])return n[a].apply(this,Array.prototype.slice.call(arguments,1));if("object"!==typeof a&&a)d.error('\u041c\u0435\u0442\u043e\u0434 \u0441 \u0438\u043c\u0435\u043d\u0435\u043c "'+
a+'" \u043d\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442!');else return e.init.apply(this,arguments)}})(jQuery);